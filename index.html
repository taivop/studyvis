<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Ajakulu õppeainetele</title>
        <script type="text/javascript" src="../d3/d3.v3.js"></script>
		<style type="text/css">

			rect:hover {
				fill: orange;
			}
			
			#tooltip {
				position: absolute;
				width: 250px;
				height: auto;
				padding: 10px;
				background-color: white;
				-webkit-border-radius: 10px;
				-moz-border-radius: 10px;
				border-radius: 10px;
				-webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				-moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				pointer-events: none;
			}
			
			#tooltip.hidden {
				display: none;
			}
			
			#tooltip p {
				margin: 0;
				font-family: sans-serif;
				font-size: 16px;
				line-height: 20px;
			}
			
			.axis path,
			.axis line {
				fill: none;
				stroke: black;
				shape-rendering: crispEdges;
			}
			
			.axis text {
				font-family: sans-serif;
				font-size: 11px;
			}
			
			svg {
				position: relative;
			}
			

		</style>
    </head>
    <body>
		<div id="tooltip" class="hidden">
			<p><strong>Important Label Heading</strong></p>
			<p><span id="eap">0</span><br />
				<span id="h_per_eap">0</span>
				</p>
		</div>
	
        <script type="text/javascript">
			//Get data
			var dataset = [];
			var accessor = function(d) {
				return {
					aine: d.aine,
					eap: +d.eap,			// convert to number
					h_per_eap: +d.h_per_eap	// convert to number
				};	
			}
			var parser = d3.dsv(";", "text/plain");
            var file = parser("data/study_data.csv", accessor, function(error, rows) {
				dataset = rows;			
				
				//Width and height
				var w = 600;
				var h = 250;
				var padding_left = 30;
				var padding_right = 30;
				var padding_bottom = 10;
				var padding_top = 10;
				
				//Scale functions
				var xScale = d3.scale.ordinal()
								.domain(d3.range(dataset.length))
								.rangeRoundBands([padding_left, w-padding_right], 0.05);

				var yScale = d3.scale.linear()
								.domain([0, 27])
								.range([h-padding_bottom, padding_top]);
				
				//Define Y axis
				var yAxis = d3.svg.axis()
							  .scale(yScale)
							  .orient("left")
							  .ticks(5);
				
				//Create SVG element
				var svg = d3.select("body")
							.append("svg")
							.attr("width", w)
							.attr("height", h);
							
				
				//Create bars
				svg.selectAll("rect")
				   .data(dataset)
				   .enter()
				   .append("rect")
				   .attr("x", function(d, i) {
						return xScale(i);
				   })
				   .attr("y", function(d) {
						return yScale(d.h_per_eap);
				   })
				   .attr("width", xScale.rangeBand())
				   .attr("height", function(d) {
						return yScale(0) - yScale(d.h_per_eap);
				   })
				   .attr("fill", function(d) {
						return "rgb(0, 0, " + (d.h_per_eap * 10) + ")";
				   })
				   .on("mouseover", function(d) {

						//Get this bar's x/y values, then augment for the tooltip
						var xPosition = parseFloat(d3.select(this).attr("x")) + xScale.rangeBand() / 2;
						var yPosition = parseFloat(d3.select(this).attr("y")) / 2 + h / 2;

						//Update the tooltip position and value
						tooltip = d3.select("#tooltip")
							.style("left", xPosition + "px")
							.style("top", yPosition + "px")	
							
						tooltip.select("#h_per_eap")
							.text("tunde/EAP: " + d.h_per_eap.toFixed(1));
						tooltip.select("#eap")
							.text(d.eap + " EAP");
						tooltip.select("strong")
							.text(d.aine);
				   
						//Show the tooltip
						tooltip.classed("hidden", false);

				   })
				   .on("mouseout", function() {
				   
						//Hide the tooltip
						d3.select("#tooltip").classed("hidden", true);
						
			   });
				
				//Create 'nominal EAP' line
				svg.append("path")
					.attr("d", "M " + xScale(0) + " " + Math.round(yScale(26)) +
							" H" + (w-padding_right))
					.attr("stroke", "red");
					
					/*.attr("x", xScale(0))
					.attr("y", yScale(26))
					.attr("width", w - padding_left - padding_right)
					.attr("height", "1")
					.attr("fill", "red");*/
				
				//Create Y axis
				svg.append("g")
					.attr("class", "axis")
					.attr("transform", "translate(" + padding_left + ",0)")
					.call(yAxis);
			});
        </script>
    </body>
</html>